###########################################################################
# Apertis
###########################################################################

{% macro apertis(version, minpackages, suffix='', development=False, hmi=False) %}
- name: apertis_v{{version}}
  type: repository
  desc: Apertis v{{version}}{% if development %} Development{% endif %}
  statsgroup: Debian+derivs
  family: debuntu
  ruleset: [debuntu, apertis]
  color: '3a5a80'
  minpackages: {{minpackages}}
  sources:
    {% set v = 'v' + version|string + suffix %}
    {% for sub1 in ([v] if development else [v, v + '-updates']) %}
    {% for sub2 in (['development', 'target', 'sdk', 'hmi'] if hmi else ['development', 'target', 'sdk']) %}
    {% set source = sub1 + '/' + sub2 %}
    - name: {{source}}
      fetcher:
        class: FileFetcher
        url: 'https://repositories.apertis.org/apertis/dists/{{source}}/source/Sources.gz'
        compression: gz
      parser:
        class: DebianSourcesParser
      subrepo: {{source}}
    {% endfor %}
    {% endfor %}
  repolinks:
    - desc: Apertis home
      url: https://www.apertis.org/
    - desc: Apertis GitLab
      url: https://gitlab.apertis.org/
    - desc: Apertis Quality Assurance reports
      url: https://qa.apertis.org/
  packagelinks:
    - type: PACKAGE_SOURCES
      url: 'https://gitlab.apertis.org/pkg/{srcname}/-/tree/apertis/{{v}}'
    - type: PACKAGE_BUILD_STATUS
      url: 'https://gitlab.apertis.org/pkg/{srcname}/-/pipelines?ref=apertis/{{v}}'
  groups: [ all, production, apertis ]
{% endmacro %}

{{ apertis(2021, minpackages=3500, hmi=true) }}
{{ apertis(2022, minpackages=3500) }}
{{ apertis(2023, minpackages=3500) }}
{{ apertis(2024, suffix='pre', minpackages=3500, development=true) }}
